<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tolerance Dashboard</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0a;
      color: #e0e0e0;
      min-height: 100vh;
      padding: 24px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 1px solid #222;
    }

    h1 {
      font-size: 24px;
      font-weight: 600;
      color: #fff;
    }

    .mode-badge {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
    }

    .mode-baseline {
      background: #2d4a3e;
      color: #7dcea0;
    }

    .mode-active {
      background: #3d2d4a;
      color: #b07dce;
    }

    .btn-small {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      background: #2d4a3e;
      color: #7dcea0;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-small:hover {
      background: #3d5a4e;
    }

    /* Progressive Boredom Phase Styles */
    .phase-indicator {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .phase-normal {
      background: #1a472a;
      color: #4caf50;
    }

    .phase-reduced {
      background: #3d3d1a;
      color: #ffc107;
    }

    .phase-wind-down {
      background: #4a2d1a;
      color: #ff9800;
    }

    .phase-minimal {
      background: #4a1a1a;
      color: #f44336;
    }

    .session-progress {
      display: flex;
      gap: 4px;
      margin-top: 12px;
    }

    .session-progress-segment {
      flex: 1;
      height: 8px;
      border-radius: 4px;
      background: #222;
      position: relative;
      overflow: hidden;
    }

    .session-progress-fill {
      height: 100%;
      transition: width 0.3s ease;
    }

    .session-time-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 10px;
      color: #666;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .card {
      background: #141414;
      border: 1px solid #222;
      border-radius: 12px;
      padding: 20px;
    }

    .card h2 {
      font-size: 14px;
      font-weight: 500;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
    }

    .big-number {
      font-size: 48px;
      font-weight: 600;
      color: #fff;
    }

    .chart-container {
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #444;
    }

    .distribution-bars {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .bar-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .bar-label {
      width: 80px;
      font-size: 13px;
      color: #888;
    }

    .bar-container {
      flex: 1;
      height: 24px;
      background: #222;
      border-radius: 4px;
      overflow: hidden;
    }

    .bar {
      height: 100%;
      transition: width 0.3s ease;
    }

    .bar-high { background: #e74c3c; }
    .bar-medium { background: #f39c12; }
    .bar-low { background: #27ae60; }

    .bar-value {
      width: 50px;
      text-align: right;
      font-size: 13px;
      font-weight: 500;
    }

    .sessions-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .session-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #222;
    }

    .session-item:last-child {
      border-bottom: none;
    }

    .session-date {
      font-size: 13px;
      color: #888;
    }

    .session-stats {
      font-size: 13px;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-primary {
      background: #3d2d4a;
      color: #b07dce;
    }

    .btn-primary:hover {
      background: #4d3d5a;
    }

    .btn-secondary {
      background: #222;
      color: #888;
    }

    .btn-secondary:hover {
      background: #333;
    }

    .empty-state {
      text-align: center;
      padding: 48px;
      color: #444;
    }

    .settings-section {
      margin-top: 32px;
      padding-top: 32px;
      border-top: 1px solid #222;
    }

    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #222;
    }

    .setting-label {
      font-size: 14px;
    }

    .setting-description {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    input[type="text"], input[type="number"] {
      background: #222;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 8px 12px;
      color: #fff;
      font-size: 14px;
      width: 200px;
    }

    input:focus {
      outline: none;
      border-color: #555;
    }

    /* Narrative Awareness Styles */
    .narrative-alert {
      background: #4a2d2d;
      border: 1px solid #6b3d3d;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 16px;
      color: #ff9999;
      font-size: 13px;
    }

    .narrative-bars {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .narrative-bar-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .narrative-label {
      width: 120px;
      font-size: 12px;
      color: #888;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .narrative-bar-container {
      flex: 1;
      height: 20px;
      background: #222;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .narrative-bar {
      height: 100%;
      transition: width 0.3s ease;
    }

    .bar-doom { background: #9b59b6; }
    .bar-conspiracy { background: #e67e22; }
    .bar-identity { background: #3498db; }
    .bar-user { background: #1abc9c; }

    .baseline-marker {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #fff;
      opacity: 0.5;
    }

    .narrative-value {
      width: 50px;
      text-align: right;
      font-size: 12px;
      color: #666;
    }

    .time-selector {
      display: flex;
      gap: 8px;
    }

    .time-btn {
      padding: 6px 12px;
      background: #222;
      border: 1px solid #333;
      color: #888;
      font-size: 12px;
      cursor: pointer;
    }

    .time-btn.active {
      background: #3d2d4a;
      border-color: #4d3d5a;
      color: #b07dce;
    }

    .badge {
      display: inline-block;
      background: #e74c3c;
      color: #fff;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      margin-left: 8px;
    }

    .emerging-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .emerging-item {
      padding: 12px;
      background: #1a1a1a;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .emerging-name {
      font-weight: 500;
      color: #fff;
      margin-bottom: 4px;
    }

    .emerging-desc {
      font-size: 12px;
      color: #888;
      margin-bottom: 8px;
    }

    .emerging-samples {
      font-size: 11px;
      color: #555;
      max-height: 60px;
      overflow: hidden;
    }

    .emerging-sample {
      margin-bottom: 2px;
    }

    .emerging-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .emerging-actions button {
      padding: 4px 8px;
      font-size: 11px;
    }

    .strategies-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .strategy-item {
      padding: 16px;
      background: #1a1a1a;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 3px solid #3d2d4a;
    }

    .strategy-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .strategy-theme-badge {
      display: inline-block;
      padding: 4px 8px;
      background: #3d2d4a;
      border-radius: 4px;
      font-size: 12px;
      color: #b07dce;
    }

    .strategy-toggle {
      padding: 4px 8px;
      font-size: 11px;
    }

    .strategy-dialectic {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      font-size: 12px;
    }

    .dialectic-col {
      padding: 8px;
      background: #222;
      border-radius: 4px;
    }

    .dialectic-label {
      color: #666;
      margin-bottom: 4px;
      font-size: 10px;
      text-transform: uppercase;
    }

    .dialectic-text {
      color: #ccc;
    }

    .strategy-meta {
      margin-top: 12px;
      font-size: 11px;
      color: #555;
    }

    /* Theme Management Styles */
    .themes-list {
      max-height: 500px;
      overflow-y: auto;
    }

    .theme-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 16px;
      background: #1a1a1a;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 3px solid #2d4a3a;
    }

    .theme-item.inactive {
      opacity: 0.5;
      border-left-color: #333;
    }

    .theme-item.system-theme {
      border-left-color: #4a3d2d;
    }

    .theme-info {
      flex: 1;
      min-width: 0;
    }

    .theme-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .theme-name {
      font-weight: 500;
      color: #fff;
      font-size: 14px;
    }

    .theme-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      text-transform: uppercase;
      font-weight: 600;
    }

    .theme-badge.system {
      background: #4a3d2d;
      color: #cea07d;
    }

    .theme-badge.custom {
      background: #2d4a3a;
      color: #7dcea0;
    }

    .theme-badge.inactive-badge {
      background: #333;
      color: #888;
    }

    .theme-description {
      font-size: 12px;
      color: #888;
      line-height: 1.5;
      margin-bottom: 8px;
      max-height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .theme-description.expanded {
      max-height: none;
    }

    .theme-expand-btn {
      font-size: 11px;
      color: #7dcea0;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      margin-bottom: 8px;
    }

    .theme-expand-btn:hover {
      text-decoration: underline;
    }

    .theme-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-left: 16px;
    }

    .theme-toggle {
      position: relative;
      width: 44px;
      height: 24px;
      background: #333;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .theme-toggle.active {
      background: #2d5a3d;
    }

    .theme-toggle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: #666;
      border-radius: 50%;
      transition: transform 0.2s, background 0.2s;
    }

    .theme-toggle.active::after {
      transform: translateX(20px);
      background: #7dcea0;
    }

    .theme-action-btns {
      display: flex;
      gap: 4px;
    }

    .theme-action-btns button {
      padding: 4px 8px;
      font-size: 11px;
      background: #2a2a2a;
      border: 1px solid #333;
      border-radius: 4px;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .theme-action-btns button:hover {
      border-color: #555;
      color: #ccc;
    }

    .theme-action-btns button.delete-btn:hover {
      border-color: #a04040;
      color: #ff8888;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 24px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-content h3 {
      margin-bottom: 20px;
      color: #fff;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      color: #888;
      margin-bottom: 6px;
    }

    .form-group select,
    .form-group textarea {
      width: 100%;
      background: #222;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 8px 12px;
      color: #fff;
      font-size: 14px;
      font-family: inherit;
    }

    .form-group textarea {
      min-height: 60px;
      resize: vertical;
    }

    .form-group input[type="range"] {
      width: 100%;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    /* Quality Mode Toggle Slider */
    #quality-mode-slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background-color: #888;
      transition: 0.3s;
      border-radius: 50%;
    }

    #quality-mode-toggle:checked + #quality-mode-slider {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    #quality-mode-toggle:checked + #quality-mode-slider:before {
      transform: translateX(24px);
      background-color: #fff;
    }

    #quality-mode-section.active {
      border-color: #667eea;
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Tolerance Dashboard</h1>
      <div id="api-status-header" style="display: flex; align-items: center; gap: 8px; cursor: pointer;" title="Click to configure API">
        <span id="api-status-dot" style="width: 8px; height: 8px; border-radius: 50%; background: #666;"></span>
        <span id="api-status-text" style="color: #666; font-size: 13px;">No API Key</span>
      </div>
    </header>

    <!-- Trusted Sources (Whitelist) Section - Moved to top -->
    <div class="settings-section" style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
      <h2 style="margin-bottom: 8px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Trusted Sources</h2>
      <p style="color: #666; font-size: 13px; margin-bottom: 16px;">Posts from these sources won't be blurred. <strong style="color: #7dcea0;">Tip:</strong> Right-click any post to quickly trust that author.</p>

      <!-- Add new entry form -->
      <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
        <input type="text" id="whitelist-source" placeholder="@username or u/username" style="flex: 1; min-width: 180px;" />
        <select id="whitelist-platform" style="padding: 8px 12px; background: #2a2a2a; border: 1px solid #333; border-radius: 6px; color: #ccc; font-size: 14px;">
          <option value="twitter">Twitter/X</option>
          <option value="reddit">Reddit</option>
          <option value="instagram">Instagram</option>
          <option value="youtube">YouTube</option>
        </select>
        <input type="text" id="whitelist-reason" placeholder="Reason (optional)" style="width: 200px;" />
        <button id="add-whitelist-btn" class="btn-primary" style="padding: 8px 16px;">Add</button>
      </div>

      <!-- Whitelist entries -->
      <div id="whitelist-list" style="background: #141414; border-radius: 8px; padding: 12px;">
        <div class="empty-state" style="padding: 24px; color: #555;">No trusted sources added yet.</div>
      </div>
    </div>

    <!-- API Setup Section - Moved to top -->
    <div id="api-setup" class="settings-section" style="background: #1a1a1a; border: 2px solid #3d2d4a; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
      <h2 id="api-setup-title" style="margin-bottom: 16px; color: #b07dce; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">⚙️ API Configuration</h2>

      <!-- API Tier Selection -->
      <div style="margin-bottom: 20px;">
        <div style="font-size: 13px; color: #888; margin-bottom: 12px;">Choose how to access the AI scoring API:</div>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <label style="display: flex; align-items: flex-start; gap: 10px; padding: 14px 18px; background: #222; border: 2px solid #333; border-radius: 8px; cursor: pointer; flex: 1; min-width: 200px;" id="tier-free-label">
            <input type="radio" name="api-tier" value="free" id="tier-free" style="margin-top: 2px;" />
            <div>
              <div style="font-weight: 500; color: #fff;">Free Tier</div>
              <div style="font-size: 12px; color: #888; margin-top: 2px;">Try without setup - limited daily usage</div>
            </div>
          </label>
          <label style="display: flex; align-items: flex-start; gap: 10px; padding: 14px 18px; background: #222; border: 2px solid #333; border-radius: 8px; cursor: pointer; flex: 1; min-width: 200px;" id="tier-own-key-label">
            <input type="radio" name="api-tier" value="own-key" id="tier-own-key" style="margin-top: 2px;" />
            <div>
              <div style="font-weight: 500; color: #fff;">Own API Key</div>
              <div style="font-size: 12px; color: #888; margin-top: 2px;">Extended usage with your API key</div>
            </div>
          </label>
        </div>
      </div>

      <!-- Own Key Section - shown when own-key selected -->
      <div id="own-key-section" class="setting-row" style="border-bottom: none; padding-bottom: 0; display: none;">
        <div>
          <div class="setting-label" style="font-size: 16px;"> API Key</div>
          <div class="setting-description">Get your key from <a href="https://tolerance.lol/account.html" target="_blank" style="color: #4a9eff;">tolerance.lol/account.html</a> or directly from Openrouter. More endpoint options below.</div>
        </div>
        <input type="text" id="api-key" placeholder="sk-or-..." style="width: 280px;" />
      </div>

      <div id="api-key-status" style="margin-top: 12px; padding: 8px 12px; border-radius: 6px; font-size: 13px; display: none;"></div>
    </div>

    <div class="grid">
      <!-- Threshold Controls Card -->
      <div class="card" style="grid-column: span 2;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h2>Blur Thresholds</h2>
          <button id="reset-thresholds-btn-top" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;">Reset</button>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Normal: <span id="blur-normal-value-top">100</span></div>
            <input type="range" id="blur-normal-top" min="20" max="100" step="5" value="100" style="width: 100%;" />
          </div>
          <div>
            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Reduced: <span id="blur-reduced-value-top">75</span></div>
            <input type="range" id="blur-reduced-top" min="20" max="100" step="5" value="75" style="width: 100%;" />
          </div>
          <div>
            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Wind-down: <span id="blur-winddown-value-top">65</span></div>
            <input type="range" id="blur-winddown-top" min="20" max="100" step="5" value="65" style="width: 100%;" />
          </div>
          <div>
            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Minimal: <span id="blur-minimal-value-top">55</span></div>
            <input type="range" id="blur-minimal-top" min="20" max="100" step="5" value="55" style="width: 100%;" />
          </div>
        </div>
        <div style="font-size: 11px; color: #666; margin-top: 8px;">Score at which posts get blurred in each phase</div>
      </div>

      <div class="card">
        <h2>Progressive Boredom</h2>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <div id="session-time" style="font-size: 28px; font-weight: 600; color: #fff;">0m</div>
          <div>
            <div id="phase-badge" class="phase-indicator phase-normal">Normal</div>
            <div style="font-size: 11px; color: #666; margin-top: 4px;">Today's social media time</div>
          </div>
        </div>
        <div class="session-progress">
          <div class="session-progress-segment">
            <div id="progress-normal" class="session-progress-fill" style="background: #4caf50; width: 0%"></div>
          </div>
          <div class="session-progress-segment">
            <div id="progress-reduced" class="session-progress-fill" style="background: #ffc107; width: 0%"></div>
          </div>
          <div class="session-progress-segment">
            <div id="progress-winddown" class="session-progress-fill" style="background: #ff9800; width: 0%"></div>
          </div>
          <div class="session-progress-segment">
            <div id="progress-minimal" class="session-progress-fill" style="background: #f44336; width: 0%"></div>
          </div>
        </div>
        <div class="session-time-labels">
          <span>0</span>
          <span id="threshold-normal">30m</span>
          <span id="threshold-reduced">60m</span>
          <span id="threshold-winddown">90m</span>
          <span>120m+</span>
        </div>
        <div style="font-size: 11px; color: #666; margin-top: 8px;">
          Ratio: <span id="effective-ratio" style="color: #888;">20%</span> high-engagement posts
        </div>
      </div>

      <div class="card" id="quality-mode-section" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 1px solid #4a4a8a;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
          <h2 style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 20px;">&#9733;</span>
            Quality Mode
          </h2>
          <label style="position: relative; display: inline-block; width: 52px; height: 28px; flex-shrink: 0;">
            <input type="checkbox" id="quality-mode-toggle" style="opacity: 0; width: 0; height: 0;">
            <span id="quality-mode-slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: 0.3s; border-radius: 28px;"></span>
          </label>
        </div>
        <div style="margin-top: 12px; font-size: 13px; color: #888; line-height: 1.5;">
          Instantly blur all high-engagement content (score 20+). Skip the gradual phases and go straight to strict filtering.
        </div>
        <div id="quality-mode-status" style="margin-top: 12px; font-size: 12px; font-weight: 600; color: #667eea; display: none;">
          &#10003; Active - Maximum content filtering
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid">
      <div class="card">
        <h2>Total Posts Seen</h2>
        <div class="big-number" id="total-posts">0</div>
      </div>

      <div class="card">
        <h2>Total Sessions</h2>
        <div class="big-number" id="total-sessions">0</div>
      </div>

      <div class="card">
        <h2>Posts Reordered</h2>
        <div class="big-number" id="posts-reordered">0</div>
      </div>

      <div class="card">
        <h2>Engagement Distribution</h2>
        <div class="distribution-bars">
          <div class="bar-row">
            <span class="bar-label">High</span>
            <div class="bar-container">
              <div class="bar bar-high" id="bar-high" style="width: 0%"></div>
            </div>
            <span class="bar-value" id="pct-high">0%</span>
          </div>
          <div class="bar-row">
            <span class="bar-label">Medium</span>
            <div class="bar-container">
              <div class="bar bar-medium" id="bar-medium" style="width: 0%"></div>
            </div>
            <span class="bar-value" id="pct-medium">0%</span>
          </div>
          <div class="bar-row">
            <span class="bar-label">Low</span>
            <div class="bar-container">
              <div class="bar bar-low" id="bar-low" style="width: 0%"></div>
            </div>
            <span class="bar-value" id="pct-low">0%</span>
          </div>
        </div>
      </div>

    </div>

    <div class="card">
      <h2>Recent Sessions</h2>
      <div class="sessions-list" id="sessions-list">
        <div class="empty-state">No sessions recorded yet</div>
      </div>
    </div>

    <!-- Narrative Awareness Section -->
    <div class="section-header" style="margin-top: 32px; margin-bottom: 16px;">
      <h2 style="color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Narrative Awareness</h2>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Narrative Trends (Today)</h2>
        <div id="narrative-alert" class="narrative-alert" style="display: none;"></div>
        <div class="narrative-bars" id="narrative-bars">
          <div class="empty-state" style="padding: 24px;">No narrative data yet. Browse Reddit to start tracking.</div>
        </div>
        <div class="time-selector" style="margin-top: 16px;">
          <button class="time-btn active" data-days="1">Today</button>
          <button class="time-btn" data-days="7">7 Days</button>
          <button class="time-btn" data-days="30">30 Days</button>
        </div>
      </div>

      <!-- Custom Narrative Creation -->
      <div class="card">
        <h2>Create Custom Narrative</h2>
        <p style="color: #888; font-size: 13px; margin-bottom: 12px;">
          Describe what kind of content you want to filter. The AI will intelligently detect matching posts.
        </p>
        <div class="form-group">
          <label>Narrative Name</label>
          <input type="text" id="custom-theme-name" placeholder="Politics / Kardashians / etc." />
        </div>
        <div class="form-group">
          <label>Description (for AI detection)</label>
          <textarea id="custom-theme-desc" rows="4" placeholder="Describe the type of content this narrative represents. Be specific about tone, topics, and patterns you want to detect. Example: 'Content promoting fear and uncertainty about job security, including discussions of mass layoffs, AI replacing workers, or economic doom without actionable solutions.'"></textarea>
        </div>
        <button id="save-custom-theme-btn" class="btn-primary" style="width: 100%;">Create Narrative</button>
      </div>

      <div class="card">
        <h2>Emerging Narratives <span id="emerging-badge" class="badge" style="display: none;">0</span></h2>
        <div id="emerging-list" class="emerging-list">
          <div class="empty-state" style="padding: 24px;">No emerging patterns detected yet.</div>
        </div>
        <button class="btn-secondary" id="trigger-discovery-btn" style="margin-top: 12px; width: 100%;">
          Run Discovery (<span id="unclassified-count">0</span> unclassified posts)
        </button>
      </div>
    </div>

    <!-- Manage Narratives Section -->
    <div class="card" style="margin-top: 24px;">
      <h2>Manage Narratives</h2>
      <p style="color: #888; font-size: 13px; margin-bottom: 16px;">
        View and manage all narratives. Toggle narratives on/off to control what the AI detects.
      </p>
      <div id="themes-list" class="themes-list">
        <div class="empty-state" style="padding: 24px;">Loading narratives...</div>
      </div>
    </div>

    <!-- Edit Narrative Modal -->
    <div id="edit-theme-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <h3>Edit Narrative</h3>
        <div class="form-group">
          <label>Narrative Name</label>
          <input type="text" id="edit-theme-name" />
        </div>
        <div class="form-group">
          <label>Description (for AI detection)</label>
          <textarea id="edit-theme-desc" rows="4"></textarea>
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" id="cancel-edit-theme-btn">Cancel</button>
          <button class="btn-primary" id="save-edit-theme-btn">Save Changes</button>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top: 24px;">
      <h2>Counter-Strategies (Dialectical)</h2>
      <div id="strategies-list" class="strategies-list">
        <div class="empty-state" style="padding: 24px;">No counter-strategies configured. Add one to start.</div>
      </div>
      <button class="btn-primary" id="add-strategy-btn" style="margin-top: 12px;">+ Add Counter-Strategy</button>
    </div>

    <!-- Strategy Modal -->
    <div id="strategy-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <h3>Configure Counter-Strategy</h3>
        <div class="form-group">
          <label>Target Narrative</label>
          <select id="strategy-theme"></select>
        </div>
        <div class="form-group">
          <label>Thesis (The Narrative)</label>
          <textarea id="strategy-thesis" placeholder="Auto-filled from theme description" readonly></textarea>
        </div>
        <div class="form-group">
          <label>Score Modifier: <span id="modifier-value">+20</span> points</label>
          <input type="range" id="strategy-modifier" min="-50" max="50" value="20">
          <div class="setting-description">Positive = blur more (suppress). Negative = blur less (surface).</div>
        </div>
        <details class="dialectical-section">
          <summary style="cursor: pointer; color: #888; margin: 16px 0;">Add dialectical notes (optional)</summary>
          <div class="form-group">
            <label>Antithesis (optional)</label>
            <textarea id="strategy-antithesis" placeholder="Direct opposite perspective"></textarea>
          </div>
          <div class="form-group">
            <label>Synthesis (optional)</label>
            <textarea id="strategy-synthesis" placeholder="Nuanced, balanced view"></textarea>
          </div>
        </details>
        <div class="modal-actions">
          <button class="btn-secondary" id="cancel-strategy-btn">Cancel</button>
          <button class="btn-primary" id="save-strategy-btn">Save Strategy</button>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn-primary" id="export-btn">Export Data (JSON)</button>
      <button class="btn-secondary" id="clear-btn">Clear All Data</button>
    </div>

    <!-- Quick Reset Button - Always visible, no blur -->
    <div style="margin-top: 32px; text-align: center;">
      <button id="quick-reset-btn" style="padding: 12px 24px; font-size: 14px; font-weight: 600; background: linear-gradient(135deg, #1a4a2a 0%, #2d5a3d 100%); color: #7dcea0; border: 1px solid #3d7a4d; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
        Reset to Calibrated Thresholds
      </button>
      <div style="color: #666; font-size: 12px; margin-top: 8px;">Restore default blur thresholds and phase timing</div>
    </div>

    <!-- Advanced API Settings -->
    <div class="settings-section" style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 24px; margin-top: 24px;">
      <h2 style="margin-bottom: 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Advanced API Settings</h2>

      <!-- Provider Type Selection -->
      <div class="setting-row" style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
        <div>
          <div class="setting-label">Provider Type</div>
          <div class="setting-description">Use OpenRouter or a custom OpenAI-compatible endpoint</div>
        </div>
        <select id="provider-type" style="padding: 8px 12px; background: #2a2a2a; border: 1px solid #333; border-radius: 6px; color: #ccc; font-size: 14px; cursor: pointer;">
          <option value="openrouter">OpenRouter (Recommended)</option>
          <option value="openai-compatible">Custom Endpoint (Ollama, vLLM, etc.)</option>
        </select>
      </div>

      <!-- Custom Endpoint Settings - hidden by default -->
      <div id="custom-endpoint-section" style="display: none; margin-top: 16px; padding: 16px; background: #141414; border-radius: 8px; border: 1px solid #333;">
        <div class="setting-row" style="border-bottom: 1px solid #222;">
          <div>
            <div class="setting-label">Endpoint URL</div>
            <div class="setting-description">Full URL to chat completions endpoint</div>
          </div>
          <input type="text" id="custom-endpoint" placeholder="http://localhost:11434/v1/chat/completions" style="width: 320px;" />
        </div>

        <div class="setting-row" style="border-bottom: 1px solid #222;">
          <div>
            <div class="setting-label">API Key</div>
            <div class="setting-description">Leave empty for local endpoints that don't require auth</div>
          </div>
          <input type="password" id="custom-api-key" placeholder="sk-..." style="width: 280px;" />
        </div>

        <div class="setting-row" style="border-bottom: 1px solid #222;">
          <div>
            <div class="setting-label">Text Model</div>
            <div class="setting-description">Model name for text scoring (leave empty for default)</div>
          </div>
          <input type="text" id="custom-text-model" placeholder="llama3.2" style="width: 200px;" />
        </div>

        <div class="setting-row" style="border-bottom: 1px solid #222;">
          <div>
            <div class="setting-label">Vision Model</div>
            <div class="setting-description">Model for image scoring (leave empty to disable vision)</div>
          </div>
          <input type="text" id="custom-vision-model" placeholder="llava" style="width: 200px;" />
        </div>

        <div class="setting-row" style="border-bottom: none;">
          <div>
            <div class="setting-label">Track Costs</div>
            <div class="setting-description">Disable for local/free models</div>
          </div>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="track-costs" style="width: 18px; height: 18px; cursor: pointer;" />
            <span id="track-costs-status" style="color: #888; font-size: 13px;">Disabled</span>
          </label>
        </div>

        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #333;">
          <button id="test-endpoint-btn" style="padding: 10px 20px; background: #3d2d4a; color: #b07dce; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.2s;">
            Test Connection
          </button>
          <div id="test-endpoint-status" style="margin-top: 12px; padding: 10px 14px; border-radius: 6px; font-size: 13px; display: none;"></div>
        </div>
      </div>
    </div>

    <!-- Platform Toggles - With blur protection -->
    <div class="settings-section" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #222;">
      <h2 style="margin-bottom: 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Platforms</h2>
      <div id="platform-controls-wrapper" style="background: #141414; border-radius: 8px; padding: 16px;">
        <div style="display: flex; gap: 24px; flex-wrap: wrap;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px 16px; background: #1a1a1a; border-radius: 8px; border: 1px solid #333;">
            <input type="checkbox" id="platform-reddit" checked style="width: 18px; height: 18px; cursor: pointer;" />
            <span style="font-size: 14px;">Reddit</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px 16px; background: #1a1a1a; border-radius: 8px; border: 1px solid #333;">
            <input type="checkbox" id="platform-twitter" checked style="width: 18px; height: 18px; cursor: pointer;" />
            <span style="font-size: 14px;">Twitter/X</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px 16px; background: #1a1a1a; border-radius: 8px; border: 1px solid #333;">
            <input type="checkbox" id="platform-youtube" checked style="width: 18px; height: 18px; cursor: pointer;" />
            <span style="font-size: 14px;">YouTube</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px 16px; background: #1a1a1a; border-radius: 8px; border: 1px solid #333;">
            <input type="checkbox" id="platform-instagram" checked style="width: 18px; height: 18px; cursor: pointer;" />
            <span style="font-size: 14px;">Instagram</span>
          </label>
        </div>
        <div style="margin-top: 8px; font-size: 12px; color: #666;">Disable platforms to turn off Tolerance scoring on that site.</div>
      </div>
    </div>

    <!-- Advanced Settings Toggle -->
    <div style="margin-top: 24px; padding: 12px 0;">
      <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #888; font-size: 14px;">
        <input type="checkbox" id="show-advanced" style="width: 16px; height: 16px; cursor: pointer;" />
        Show Advanced Settings
      </label>
    </div>

    <!-- Advanced Settings Section - Hidden by default -->
    <div id="advanced-settings" class="settings-section" style="display: none; border-top: 1px solid #222; padding-top: 24px;">
      <h2 style="margin-bottom: 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Advanced Settings</h2>

      <!-- Baseline Mode -->
      <div class="setting-row" id="baseline-row">
        <div>
          <div class="setting-label">Baseline Mode</div>
          <div class="setting-description">Collect data without reordering posts (for analysis)</div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
          <span id="baseline-status" style="color: #888;">Active Mode</span>
          <button id="toggle-baseline-btn" class="btn-small">Enter Baseline</button>
        </div>
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">API Sample Rate</div>
          <div class="setting-description">% of posts sent to API for scoring (0-100)</div>
        </div>
        <input type="number" id="api-sample-rate" min="0" max="100" step="5" value="10" />
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">High Engagement Ratio</div>
          <div class="setting-description">Fraction of feed that can be high-engagement (0.1 - 0.5)</div>
        </div>
        <input type="number" id="engagement-ratio" min="0.1" max="0.5" step="0.05" value="0.2" />
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">Cooldown Posts</div>
          <div class="setting-description">Minimum posts between high-engagement content</div>
        </div>
        <input type="number" id="cooldown-posts" min="1" max="20" value="4" />
      </div>

      <h2 style="margin: 24px 0 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Blur Settings (Twitter/YouTube)</h2>

      <div class="setting-row">
        <div>
          <div class="setting-label">Hover Reveal Delay: <span id="hover-delay-value">3</span>s</div>
          <div class="setting-description">Seconds to hover before revealing blurred content (1-10s)</div>
        </div>
        <input type="range" id="hover-delay" min="1" max="10" step="1" value="3" style="width: 200px;" />
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">Blur Intensity: <span id="blur-intensity-value">8</span>px</div>
          <div class="setting-description">Amount of blur applied to content (4-16px)</div>
        </div>
        <input type="range" id="blur-intensity" min="4" max="16" step="1" value="8" style="width: 200px;" />
      </div>

      <h2 style="margin: 24px 0 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Testing</h2>

      <div class="setting-row">
        <div>
          <div class="setting-label">Simulate Session Time: <span id="test-boredom-value">0</span> min</div>
          <div class="setting-description">Override session time for testing boredom phases (0 = use real time)</div>
        </div>
        <input type="range" id="test-boredom" min="0" max="120" step="5" value="0" style="width: 200px;" />
      </div>

      <h2 style="margin: 24px 0 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Developer</h2>

      <div class="setting-row">
        <div>
          <div class="setting-label">Console Log Level</div>
          <div class="setting-description">Control how much debug output appears in browser console</div>
        </div>
        <select id="log-level" style="padding: 8px 12px; background: #2a2a2a; border: 1px solid #333; border-radius: 6px; color: #ccc; font-size: 14px;">
          <option value="off">Off</option>
          <option value="error" selected>Errors only</option>
          <option value="warn">Warnings</option>
          <option value="info">Info</option>
          <option value="debug">Debug (verbose)</option>
        </select>
      </div>

      <h2 style="margin: 24px 0 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Threshold Controls</h2>

      <!-- Threshold controls -->
      <div id="threshold-controls-wrapper" style="background: #1a1a1a; border-radius: 8px; padding: 20px; margin-bottom: 16px;">
        <!-- Header -->
        <div style="margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #333;">
          <div style="font-size: 14px; color: #ccc;">Custom Thresholds</div>
          <div style="font-size: 12px; color: #666;">Adjust blur sensitivity and phase timing</div>
          <span id="custom-thresholds-status" style="font-size: 11px; color: #666; margin-top: 4px; display: inline-block;">Using calibrated defaults</span>
        </div>

        <!-- Blur Thresholds -->
        <div style="margin-bottom: 20px;">
          <div style="font-size: 13px; color: #888; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Blur Thresholds (score to blur)</div>

          <div class="setting-row" style="border-bottom: 1px solid #222; padding: 12px 0;">
            <div>
              <div class="setting-label">Normal Phase: <span id="blur-normal-value">100</span></div>
              <div class="setting-description">First 15 min - 100 = no blur</div>
            </div>
            <input type="range" id="blur-normal" min="20" max="100" step="5" value="100" style="width: 180px;" />
          </div>

          <div class="setting-row" style="border-bottom: 1px solid #222; padding: 12px 0;">
            <div>
              <div class="setting-label">Reduced Phase: <span id="blur-reduced-value">75</span></div>
              <div class="setting-description">Score >= this gets blurred</div>
            </div>
            <input type="range" id="blur-reduced" min="20" max="100" step="5" value="75" style="width: 180px;" />
          </div>

          <div class="setting-row" style="border-bottom: 1px solid #222; padding: 12px 0;">
            <div>
              <div class="setting-label">Wind-down Phase: <span id="blur-winddown-value">65</span></div>
              <div class="setting-description">More content blurred</div>
            </div>
            <input type="range" id="blur-winddown" min="20" max="100" step="5" value="65" style="width: 180px;" />
          </div>

          <div class="setting-row" style="padding: 12px 0;">
            <div>
              <div class="setting-label">Minimal Phase: <span id="blur-minimal-value">55</span></div>
              <div class="setting-description">More content blurred</div>
            </div>
            <input type="range" id="blur-minimal" min="20" max="100" step="5" value="55" style="width: 180px;" />
          </div>
        </div>

        <!-- Phase Timing -->
        <div>
          <div style="font-size: 13px; color: #888; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Phase Timing (minutes)</div>

          <div class="setting-row" style="border-bottom: 1px solid #222; padding: 12px 0;">
            <div>
              <div class="setting-label">Normal → Reduced: <span id="timing-normal-value">15</span> min</div>
              <div class="setting-description">Time before blur kicks in</div>
            </div>
            <input type="range" id="timing-normal" min="5" max="60" step="5" value="15" style="width: 180px;" />
          </div>

          <div class="setting-row" style="border-bottom: 1px solid #222; padding: 12px 0;">
            <div>
              <div class="setting-label">Reduced → Wind-down: <span id="timing-reduced-value">45</span> min</div>
              <div class="setting-description">Time before stricter blur</div>
            </div>
            <input type="range" id="timing-reduced" min="15" max="90" step="5" value="45" style="width: 180px;" />
          </div>

          <div class="setting-row" style="padding: 12px 0;">
            <div>
              <div class="setting-label">Wind-down → Minimal: <span id="timing-winddown-value">75</span> min</div>
              <div class="setting-description">Time before maximum restriction</div>
            </div>
            <input type="range" id="timing-winddown" min="30" max="120" step="5" value="75" style="width: 180px;" />
          </div>
        </div>
      </div>

      <h2 style="margin: 24px 0 16px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-size: 14px;">Productivity Card</h2>

      <div class="setting-row">
        <div>
          <div class="setting-label">Enable Productivity Card</div>
          <div class="setting-description">Show a productivity reminder card in Reddit feed</div>
        </div>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="productivity-card-enabled" style="width: 18px; height: 18px; cursor: pointer;" />
          <span id="productivity-card-status" style="color: #888; font-size: 13px;">Disabled</span>
        </label>
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">RescueTime API Key</div>
          <div class="setting-description">Get from rescuetime.com/anapi/manage (optional)</div>
        </div>
        <input type="text" id="rescuetime-key" placeholder="Your API key..." />
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">Todoist URL</div>
          <div class="setting-description">Link to your Todoist (default: today view)</div>
        </div>
        <input type="text" id="todoist-url" placeholder="https://todoist.com/app/today" />
      </div>

      <div class="setting-row">
        <div>
          <div class="setting-label">Job Search Link</div>
          <div class="setting-description">Default link for job search action</div>
        </div>
        <input type="text" id="job-search-link" placeholder="https://www.linkedin.com/messaging/" />
      </div>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>
